zabbix_export:
  version: '7.2'
  template_groups:
    - uuid: a571c0d144b14fd4a87a9d9b2aa9fcd6
      name: Templates/Applications
  templates:
    - uuid: acfb2b40b9594ce39f5d155b2d21eb33
      template: 'Zabbix DB Backup Stats by Zabbix Agent Active'
      name: 'Zabbix DB Backup Stats by Zabbix Agent Active'
      description: 'Zabbix database backup statistics'
      vendor:
        name: diasdm
        version: 7.2-2
      groups:
        - name: Templates/Applications
      items:
        - uuid: ab69b1c2fd65493ab800b6554b4b9113
          name: 'DB Backup Size'
          type: DEPENDENT
          key: 'db.backup[size]'
          history: 30d
          units: B
          description: 'DB backup size'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.size
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          master_item:
            key: 'logrt["{$ZABBIX.BKP.LOG.DIR}{$ZABBIX.BKP.LOG.NAME}",">> Backup stats: (.*)",,,skip,"\1"]'
          tags:
            - tag: Backup
              value: size
        - uuid: 9cc1dfd3c42340c9a558bf73a1146ca6
          name: 'DB Backup Time'
          type: DEPENDENT
          key: 'db.backup[time]'
          history: 30d
          units: s
          description: 'DB backup time'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.time
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          master_item:
            key: 'logrt["{$ZABBIX.BKP.LOG.DIR}{$ZABBIX.BKP.LOG.NAME}",">> Backup stats: (.*)",,,skip,"\1"]'
          tags:
            - tag: Backup
              value: time
        - uuid: c04a33c13ec2447e997aaba48e09a1f8
          name: 'DB Backup Log Stats'
          type: ZABBIX_ACTIVE
          key: 'logrt["{$ZABBIX.BKP.LOG.DIR}{$ZABBIX.BKP.LOG.NAME}",">> Backup stats: (.*)",,,skip,"\1"]'
          delay: 1h
          history: '0'
          value_type: LOG
          description: 'Master item that pull the DB backup log messages'
          logtimefmt: yyyyMMddhhmmss
          tags:
            - tag: Log
              value: db_backup
      tags:
        - tag: Zabbix
          value: db_backup
      macros:
        - macro: '{$ZABBIX.BKP.LOG.DIR}'
          description: 'Full path to the backup log directory with a / at the end'
        - macro: '{$ZABBIX.BKP.LOG.NAME}'
          value: zabbix_db_bkp_full.log
          description: 'Name of the backup log file'
